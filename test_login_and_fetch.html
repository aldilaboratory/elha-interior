<!DOCTYPE html>
<html>
<head>
    <title>Test Login and Fetch</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Test Login and Fetch Endpoint</h1>
    
    <div id="status"></div>
    
    <button onclick="testLogin()">1. Test Login</button>
    <button onclick="testFetch()">2. Test Fetch Transaksi</button>
    <button onclick="testFetchProduk()">3. Test Fetch Produk</button>
    
    <div id="results"></div>

    <script>
        function updateStatus(message) {
            document.getElementById('status').innerHTML = '<p>' + message + '</p>';
        }
        
        function updateResults(data) {
            document.getElementById('results').innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
        }

        function testLogin() {
            updateStatus('Testing login...');
            
            // First get CSRF token
            $.get('/login', function(data) {
                const parser = new DOMParser();
                const doc = parser.parseFromString(data, 'text/html');
                const token = doc.querySelector('input[name="_token"]').value;
                
                updateStatus('Got CSRF token: ' + token);
                
                // Now login
                $.ajax({
                    url: '/authenticate',
                    method: 'POST',
                    data: {
                        _token: token,
                        email: 'admin@gmail.com',
                        password: 'password'
                    },
                    success: function(response) {
                        updateStatus('Login successful!');
                        updateResults(response);
                    },
                    error: function(xhr) {
                        updateStatus('Login failed: ' + xhr.status + ' ' + xhr.statusText);
                        updateResults(xhr.responseText);
                    }
                });
            });
        }

        function testFetch() {
            updateStatus('Testing fetch transaksi...');
            
            $.ajaxSetup({
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
            });
            
            $.ajax({
                url: '/admin/transaksi/fetch',
                method: 'POST',
                data: {
                    draw: 1,
                    start: 0,
                    length: 10
                },
                success: function(response) {
                    updateStatus('Fetch transaksi successful!');
                    updateResults(response);
                },
                error: function(xhr) {
                    updateStatus('Fetch transaksi failed: ' + xhr.status + ' ' + xhr.statusText);
                    updateResults(xhr.responseText);
                }
            });
        }

        function testFetchProduk() {
            updateStatus('Testing fetch produk...');
            
            $.ajaxSetup({
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
            });
            
            $.ajax({
                url: '/admin/produk/fetch',
                method: 'POST',
                data: {
                    draw: 1,
                    start: 0,
                    length: 10
                },
                success: function(response) {
                    updateStatus('Fetch produk successful!');
                    updateResults(response);
                },
                error: function(xhr) {
                    updateStatus('Fetch produk failed: ' + xhr.status + ' ' + xhr.statusText);
                    updateResults(xhr.responseText);
                }
            });
        }
    </script>
</body>
</html>